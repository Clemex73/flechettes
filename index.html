function addDart(label, points, meta=null){
  if (!state || state.finished) return;

  // ğŸ”’ max 3 flÃ©chettes par tour
  if (state.currentDarts.length >= 3) return;

  // ğŸ” snapshot AVANT modification (pour retour arriÃ¨re)
  pushUndoSnapshot();

  const p = state.players[state.current];
  const before = p.score;

  // Ajout dart
  state.currentDarts.push({label, points, meta});

  // ğŸ¯ APPLICATION IMMÃ‰DIATE DU SCORE
  if (state.mode === "x01"){
    const after = before - points;
    if (after < 0){
      // bust â†’ on annule cette flÃ©chette
      state.currentDarts.pop();
      state.undoStack.shift(); // retire snapshot inutile
      return;
    }
    p.score = after;

    if (after === 0){
      setFinished(state.current);
    }
  }

  if (state.mode === "countup"){
    p.score = before + points;
  }

  // Cricket â†’ on garde la logique existante (gÃ©rÃ©e au apply)
  if (state.mode === "cricket"){
    // rien ici (dÃ©jÃ  gÃ©rÃ© par applyTurn si tu veux garder la logique actuelle)
  }

  updateConsole();
  renderScoreboard();
  saveState();
}

